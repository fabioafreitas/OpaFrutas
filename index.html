
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>
<body style="background-color: azure;">
    <div class="container" id="app" style="height: 200vh">
        <h3>Calculadora Endereços para Distância</h3>
        <div class="row">
            <div class="col">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                      <span class="input-group-text" id="basic-addon3">Preço da gasolina (R$)</span>
                    </div>
                    <input v-model="precoGasolina" type="text" class="form-control" id="basic-url" aria-describedby="basic-addon3">
                  </div>
            </div>
            <div class="col">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                      <span class="input-group-text" id="basic-addon3">Autonomia do veículo (Km/L)</span>
                    </div>
                    <input v-model="autonomiaVeiculo" type="text" class="form-control" id="basic-url" aria-describedby="basic-addon3">
                  </div>
            </div>
            <div class="col">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                      <span class="input-group-text" id="basic-addon3">Peso da mercadoria (Kg)</span>
                    </div>
                    <input v-model="pesoMercadoria" type="text" class="form-control" id="basic-url" aria-describedby="basic-addon3">
                  </div>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <div class="row" v-for="item in enderecos1" :key="item.id">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">Endereço {{item.id}}</span>
                        </div>
                        <input v-model="item.data" type="text" class="form-control" id="basic-url" aria-describedby="basic-addon3">
                    </div>
                </div>
            </div>
            <div class="col">
                <div class="row" v-for="item in enderecos2" :key="item.id">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="basic-addon3">Endereço {{item.id}}</span>
                        </div>
                        <input v-model="item.data" type="text" class="form-control" id="basic-url" aria-describedby="basic-addon3">
                    </div>
                </div>
            </div>
        </div>  
        <div class="row">
            <div @click="calcular" class="btn btn-secondary btn-block">Calcular</div>
        </div>
        <div class="row mt-5">
            <div class="col-5"><h3>Tempo Total da Viagem:</h3></div>
            <div class="col-6"><h3>{{tempoTotal | tempo}}</h3></div>
        </div>
        <div class="row">
            <div class="col-5"><h3>Distância Total da Viagem:</h3></div>
            <div class="col"><h3>{{distanciaTotal | quilometro}}</h3></div>
        </div>
        <div class="row">
            <div class="col-5"><h3>Custo Total da Gasolina:</h3></div>
            <div class="col"><h3>{{custoGasolina | real}}</h3></div>
        </div>
        <div class="row">
            <div class="col-5"><h3>Custo por quilo:</h3></div>
            <div class="col"><h3>{{custoPorQuilo | realMaiorPrecisao}}</h3></div>
        </div>
        <div class="row">
            <div @click="copiarResultados" class="btn btn-secondary btn-block">Copiar Valores</div>
        </div>
    </div>
</div>
</body>
<footer>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script type="text/javascript" src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script type="text/javascript">
        var app = new Vue({
            el: '#app',
            data: {
                precoGasolina: 5.4,
                autonomiaVeiculo: 10,
                pesoMercadoria: 1000,
                distanciaTotal: 0,
                tempoTotal: 0,
                custoGasolina: 0,
                custoPorQuilo: 0,
                enderecos1: [
                    {'id':1, 'data': ''},
                    {'id':2, 'data': ''},
                    {'id':3, 'data': ''},
                    {'id':4, 'data': ''},
                    {'id':5, 'data': ''}
                ],
                enderecos2: [
                    {'id':6, 'data': ''},
                    {'id':7, 'data': ''},
                    {'id':8, 'data': ''},
                    {'id':9, 'data': ''},
                    {'id':10, 'data': ''}
                ],
                enderecos: [],
            },
            methods: {
                async calcular() {
                    this.distanciaTotal = 0 
                    this.tempoTotal = 0
                    this.enderecos = this.enderecos1.concat(this.enderecos2)
                    for (let i = 0; i < this.enderecos.length-1; i++) {
                        if(this.enderecos[i].data && this.enderecos[i+1].data) {
                            let erroLog = await this.requisicaoHttp(this.enderecos[i].data, this.enderecos[i+1].data)
                            if(erroLog) {
                                alert(erroLog)
                                this.distanciaTotal = 0 
                                this.tempoTotal = 0
                                break
                            }
                        }
                    }
                    this.custoGasolina = (this.distanciaTotal / this.autonomiaVeiculo) * this.precoGasolina
                    this.custoPorQuilo =  this.custoGasolina / this.pesoMercadoria
                },


                async requisicaoHttp(endereco1, endereco2) {
                    let jsonEnviar = {
                        "address1": endereco1,
                        "address2": endereco2
                    }
                    let erro = false
                    let erroLog = ''
                    await axios.post('http://opafrutas.calculadora.fabiotest.online:5000/', jsonEnviar)
                        .then(response => {
                            let dados = response.data
                            console.log(dados)
                            this.distanciaTotal = this.distanciaTotal + (dados.distancia.value / 1000) //para km
                            this.tempoTotal = this.tempoTotal + (dados.tempo.value / 3600) //para horas
                        })
                        .catch(error => {
                            console.log(error.response)
                            erro = true
                        });
                    if(erro) {
                        erroLog = 'Erro em um dos enderecos:\n\n'+endereco1+'\n\n'+endereco2
                    }
                    return erroLog
                },

                copiarResultados() {
                    /* Get the text field */
                    var copyText = '<div><table><tr><td>'+this.tempoTotal+'</td><td>'+
                        this.distanciaTotal+'</td><td>'+
                        this.custoGasolina+'</td><td>'+
                        this.custoPorQuilo+'</td></tr></table></div>'
                    copyText = copyText.replaceAll('.', ',')
                    var dummy = document.createElement("textarea");
                    document.body.appendChild(dummy);
                    dummy.value = copyText;
                    dummy.select();
                    document.execCommand("copy");
                    document.body.removeChild(dummy);
                }
            },
            filters: {
                real(value) {
                    return 'R$ ' + Number((value).toFixed(2));
                },
                realMaiorPrecisao(value) {
                    return 'R$ ' + Number((value).toFixed(5));
                },
                
                quilometro(value) {
                    return Number((value).toFixed(3)) + ' Km'
                },
                tempo(value) {
                    if(value == 0) {
                        return 0
                    }
                    segundos = value*3600
                    time = new Date(segundos * 1000).toISOString().substr(11, 8)
                    time = time.split(':')

                    return time[0] +' Hrs '+ time[1] +' min '+ time[2] +' seg'
                }
            }
        });
    </script>
</footer>
</html>
